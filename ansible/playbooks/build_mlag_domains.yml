---

- name: Play 1 - Prepare for config Output
  connection: local
  hosts: S1_LEAFS
  gather_facts: false
  vars:
    ansible_python_interpreter: /usr/bin/python3

  tasks:

    - name: Generate MLAG Configs
      template:
        src: ../templates/mlag.j2
        dest: configs/mlag/{{ inventory_hostname }}_mlag.cfg
      tags: ['build', 'deploy']
      register: mlag_configs
      when: mlag.enabled is defined and mlag.enabled

    - name: Validate MLAG Configurations against Device(s)
      arista.eos.eos_config:
        src: ../configs/mlag/{{ inventory_hostname}}_mlag.cfg
        replace: line
      check_mode: yes
      tags: ['always', 'validate']
      when: mlag_configs is not skipped

    - name: Push MLAG configuration to device(s)
      arista.eos.eos_config:
        src: ../configs/mlag/{{ inventory_hostname }}_mlag.cfg
        replace: line
        save_when: changed
      check_mode: no
      tags: ['deploy', 'never']
      when: mlag_configs is not skipped